<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Superhond — Dashboard</title>

  <!-- Centrale UI -->
  <link rel="stylesheet" href="../css/style.css?v=0.20.3" />
  <link rel="stylesheet" href="../css/superhond.css?v=0.20.3" />

  <!-- Sheets-config: backward compatible fallback -->
  <script>
    // Voorbeeld: 'https://script.google.com/macros/s/AKfycb.../exec'
    window.SUPERHOND_SHEETS_URL = window.SUPERHOND_SHEETS_URL || 'https://script.google.com/macros/s/JOUW_EXEC_URL/exec';
  </script>

  <!-- Dashboard-specifiek: GELE topbar hard-forceren -->
  <style>
    /* Altijd geel op dashboard, zowel header als inner bar */
    body.dashboard-page #topbar,
    body.dashboard-page #topbar .topbar-inner {
      background: var(--accent) !important;
      color: #000 !important;
    }
    /* (optioneel) back-knop stijl op geel */
    body.dashboard-page .btn-back {
      border-color:#e5e7eb; background:#fff; color:#111827;
    }

    /* Kleine lokale tweaks voor dit scherm */
    .tabs{display:flex;gap:.5rem;margin:1rem 0;flex-wrap:wrap}
    .tab{position:relative;padding:.4rem .8rem;border:1px solid #e5e7eb;border-radius:.5rem;background:#fff;cursor:pointer}
    .tab.active{background:var(--accent,#f4c400);font-weight:600}
    .tab .dot{position:absolute;top:-6px;right:-6px;min-width:18px;height:18px;padding:0 6px;display:inline-flex;align-items:center;justify-content:center;border-radius:999px;font-size:11px;line-height:1;background:#111827;color:#fff}
    .muted{color:#6b7280}
    .error{color:#b91c1c}
    .tile.badged{position:relative}
    .tile .badge-dot{
      position:absolute; top:8px; right:10px; min-width:22px; height:22px; padding:0 6px;
      display:inline-flex; align-items:center; justify-content:center;
      border-radius:999px; font-size:12px; line-height:1;
      background:var(--accent,#f4c400); color:#000; border:1px solid rgba(0,0,0,.08);
      box-shadow:0 1px 2px rgba(0,0,0,.08);
    }
  </style>
</head>
<body class="dashboard-page">
  <header id="topbar"></header>

  <main class="container" role="main">
    <h1 class="page-title">Hoofdmenu</h1>

    <!-- TEGELS -->
    <nav class="tiles" aria-label="Hoofdmenu">
      <a class="tile" href="../klanten/"><span class="tile-icon">👤</span><div class="tile-body"><span class="tile-title">Klanten</span></div></a>
      <a class="tile" href="../honden/"><span class="tile-icon">🐶</span><div class="tile-body"><span class="tile-title">Honden</span></div></a>
      <a class="tile" href="../strippenkaarten/"><span class="tile-icon">🎫</span><div class="tile-body"><span class="tile-title">Strippenkaarten</span></div></a>

      <a class="tile badged" href="../lessen/">
        <span class="tile-icon">📅</span>
        <div class="tile-body">
          <span class="tile-title">Lessen</span>
          <span class="tile-sub" id="lessen-week-sub">—</span>
        </div>
        <span class="badge-dot" id="lessen-week-badge" aria-label="Aantal lessen">0</span>
      </a>

      <!-- 📚 Klassen -->
      <a class="tile badged" href="../klassen/">
        <span class="tile-icon">📚</span>
        <div class="tile-body">
          <span class="tile-title">Klassen</span>
          <span class="tile-sub" id="klassen-sub">—</span>
        </div>
        <span class="badge-dot" id="klassen-badge" aria-label="Aantal actieve klassen">0</span>
      </a>

      <!-- 📦 Lessenreeksen -->
      <a class="tile badged" href="../lessenreeks/">
        <span class="tile-icon">📦</span>
        <div class="tile-body">
          <span class="tile-title">Lessenreeksen</span>
          <span class="tile-sub" id="reeksen-sub">—</span>
        </div>
        <span class="badge-dot" id="reeksen-badge" aria-label="Aantal actieve reeksen">0</span>
      </a>

      <a class="tile" href="../mededeling/"><span class="tile-icon">📢</span><div class="tile-body"><span class="tile-title">Mededelingen</span></div></a>
      <a class="tile" href="../trainers/"><span class="tile-icon">🧑‍🏫</span><div class="tile-body"><span class="tile-title">Trainers</span></div></a>
      <a class="tile" href="../rapporten/"><span class="tile-icon">📈</span><div class="tile-body"><span class="tile-title">Rapporten</span></div></a>
      <a class="tile" href="../instellingen/"><span class="tile-icon">⚙️</span><div class="tile-body"><span class="tile-title">Instellingen</span></div></a>
      <a class="tile" href="../over/"><span class="tile-icon">ℹ️</span><div class="tile-body"><span class="tile-title">Over</span></div></a>
      <a class="tile" href="../lessen/beheer.html"><span class="tile-icon">⚙️</span><div class="tile-body"><span class="tile-title">Lessenbeheer</span></div></a>

      <!-- 🛡️ Admin (verborgen tenzij admin-modus aan) -->
      <a class="tile" href="../admin/" data-admin-only style="display:none">
        <span class="tile-icon">🛡️</span>
        <div class="tile-body">
          <span class="tile-title">Admin</span>
          <span class="tile-sub">Config & Schema</span>
        </div>
      </a>
    </nav>

    <!-- AGENDA -->
    <section class="card" style="margin-top:1rem">
      <h2 style="margin:0 0 .5rem">Agenda</h2>

      <div class="tabs" id="agenda-tabs" role="tablist" aria-label="Agendaweergave">
        <button class="tab active" data-tab="week" role="tab" aria-selected="true">Deze week <span class="dot" id="tab-week-dot">0</span></button>
        <button class="tab" data-tab="alles" role="tab" aria-selected="false">Alles <span class="dot" id="tab-all-dot">0</span></button>
        <button class="tab" data-tab="mededelingen" role="tab" aria-selected="false">Mededelingen <span class="dot" id="tab-notes-dot">0</span></button>
      </div>

      <div id="agenda-loader" class="muted">⏳ Laden…</div>
      <div id="agenda-error" class="error" style="display:none"></div>

      <div class="table-wrap" id="agenda-table-wrap" style="display:none;">
        <table id="agenda-table" class="table">
          <thead>
            <tr><th>Naam</th><th>Datum</th><th>Locatie</th><th>Trainer(s)</th></tr>
          </thead>
          <tbody><!-- gevuld door ../js/agenda.js --></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer id="footer" class="footer"></footer>

  <!-- Basis scripts -->
  <script src="../js/layout.js?v=0.20.3" defer></script>
  <script src="../js/agenda.js?v=0.20.3" defer></script>
  <script src="../js/admin-gate.js?v=0.20.3" defer></script>

  <!-- Tellers: Sheets-first (met baseUrl), fallback op store.js -->
  <script type="module">
    const safeImport = async (path) => {
      try { return await import(path); }
      catch (e) { console.error(`Import mislukt: ${path}`, e); return {}; }
    };

    const sheets = await safeImport('../js/sheets.js?v=0.20.3');
    const store  = await safeImport('../js/store.js?v=0.20.3');

    const fetchSheet     = sheets.fetchSheet     || (async () => { throw new Error('sheets.fetchSheet ontbreekt'); });
    const normStatus     = sheets.normStatus     || ((s) => String(s||'').toLowerCase());
    const setBaseUrl     = sheets.setBaseUrl     || (() => {});
    const initFromConfig = sheets.initFromConfig || (async () => {});
    const ensureMigrated = store.ensureMigrated  || (() => {});
    const getKlassen     = store.getKlassen      || (() => []);
    const getReeksen     = store.getReeksen      || (() => []);
    const isActiefStatus = store.isActiefStatus  || ((s) => String(s||'').toLowerCase()==='actief');

    if (window.SUPERHOND_SHEETS_URL) setBaseUrl(window.SUPERHOND_SHEETS_URL);
    await initFromConfig(); // haalt centrale apiBase op

    async function updateBadges() {
      try {
        const [klassen, reeksen] = await Promise.all([
          fetchSheet('Klassen'),
          fetchSheet('Reeksen'),
        ]);
        const actKl = (klassen || []).filter(k => normStatus(k.status) === 'actief').length;
        const actRs = (reeksen || []).filter(r => normStatus(r.status) === 'actief').length;
        setBadges(actKl, actRs);
        return;
      } catch (e) {
        console.warn('Sheets-laden faalde, val terug op local store:', e?.message || e);
      }

      try {
        ensureMigrated();
        const actKl = (getKlassen() || []).filter(k => isActiefStatus(k.status)).length;
        const actRs = (getReeksen() || []).filter(r => isActiefStatus(r.status)).length;
        setBadges(actKl, actRs);
      } catch (e) {
        console.error('Badges updaten mislukt:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (window.SuperhondUI?.mount) {
        SuperhondUI.mount({ title: 'Superhond', icon: '🐾', home: true });
      }
      updateBadges();
    });
  </script>

  <noscript>
    <p style="padding:1rem;color:#b91c1c">JavaScript is vereist om het dashboard te laden.</p>
  </noscript>
</body>
</html>
