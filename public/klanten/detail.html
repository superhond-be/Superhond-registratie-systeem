<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Klant – Superhond</title>
  <link rel="stylesheet" href="../ui/style.css?v=0.19.0">
</head>
<body>

  <main class="container">
    <h2 class="page-title">Klantdetail</h2>

    <div id="klant-box" class="card">
      <p>Laden…</p>
    </div>

    <section class="card" style="margin-top:1rem">
      <h3 style="margin-top:0">Honden van deze klant</h3>
      <div id="honden-wrap" class="table-wrap" hidden>
        <table id="honden-tbl">
          <thead>
            <tr>
              <th>Naam</th>
              <th>Ras</th>
              <th>Chip</th>
              <th>Geboorte</th>
              <th></th>
            </tr>
          </thead>
          <tbody><!-- gevuld via JS --></tbody>
        </table>
      </div>
      <p id="honden-empty" class="muted" hidden>Geen honden geregistreerd.</p>
    </section>

    <p style="margin-top:1rem"><a href="../index.html">← Terug naar dashboard</a></p>
  </main>

  <footer class="footer">
    <small>&copy; 2025 Superhond</small>
  </footer>

  <script src="../ui/layout.js?v=0.19.0"></script>
  <script type="module">
    import { loadAll, indexById } from "../js/data.js?v=0.19.0";

    const params = new URLSearchParams(location.search);
    const klantId = params.get("id");

    const box   = document.getElementById("klant-box");
    const wrap  = document.getElementById("honden-wrap");
    const tbody = document.querySelector("#honden-tbl tbody");
    const empty = document.getElementById("honden-empty");

    (async () => {
      if (!klantId) {
        box.innerHTML = '<p class="error">Geen <code>id</code> opgegeven.</p>';
        return;
      }

      const all = await loadAll();
      const klantenById = indexById(all.klanten);
      const klant = klantenById[klantId];

      if (!klant) {
        box.innerHTML = `<p class="error">Klant <code>${klantId}</code> niet gevonden.</p>`;
        return;
      }

      box.innerHTML = `
        <h3 style="margin-top:0">${klant.naam}</h3>
        <ul>
          <li><strong>Email:</strong> ${klant.email || "—"}</li>
          <li><strong>Telefoon:</strong> ${klant.telefoon || "—"}</li>
          <li><strong>Adres:</strong> ${klant.adres || "—"}</li>
        </ul>
      `;

      // Honden van deze klant
      const rows = (all.honden || [])
        .filter(h => String(h.eigenaarId) === String(klantId))
        .map(h => `
          <tr>
            <td>${h.naam}</td>
            <td>${h.ras || "—"}</td>
            <td>${h.chip || "—"}</td>
            <td>${h.geboortedatum || "—"}</td>
            <td><a href="../honden/detail.html?id=${encodeURIComponent(h.id)}">Open</a></td>
          </tr>
        `);

      if (rows.length) {
        tbody.innerHTML = rows.join("");
        wrap.hidden = false;
        empty.hidden = true;
      } else {
        wrap.hidden = true;
        empty.hidden = false;
      }
    })();
  </script>
</body>
</html>
