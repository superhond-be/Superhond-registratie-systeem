<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hond detail ‚Äì Superhond</title>
  <link rel="stylesheet" href="/css/style.css?v=0.19.2" />
  <link rel="stylesheet" href="/css/superhond.css?v=0.19.2" />
</head>
<body>
  <header id="topbar" class="topbar"></header>

  <main class="container">
    <h2 class="page-title">Hond detail</h2>
    <div id="box" class="card">‚è≥ Bezig met laden‚Ä¶</div>
    <p><a href="/honden/" class="btn">‚Üê Terug naar honden</a></p>
  </main>

  <footer id="footer" class="footer"></footer>
  <script src="/js/layout.js?v=0.19.2"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (window.SuperhondUI?.mount) {
        SuperhondUI.mount({ title:'Hond detail', icon:'üê∂', back:'/honden/' });
      }
    });

    const S = v => String(v ?? '');
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const target = document.getElementById('box');
    const bust = () => '?t=' + Date.now();

    async function fetchJson(tryUrls) {
      for (const u of tryUrls) {
        const r = await fetch(u + bust(), { cache:'no-store' });
        if (r.ok) return r.json();
      }
      throw new Error('Geen data-bron bereikbaar ('+ tryUrls.join(', ') +')');
    }

    async function load(){
      if (!id) { target.innerHTML = '<p class="error">Geen <code>id</code> opgegeven.</p>'; return; }
      try {
        const [honden, klanten] = await Promise.all([
          fetchJson(['/api/honden',  '/data/honden.json']),
          fetchJson(['/api/klanten', '/data/klanten.json'])
        ]);

        const hond = (honden || []).find(h => String(h.id) === String(id));
        if (!hond) { target.innerHTML = `<p class="error">Hond met id <code>${S(id)}</code> niet gevonden.</p>`; return; }

        const eigenaar = (klanten || []).find(k => String(k.id) === String(hond.eigenaarId ?? hond.klantId ?? hond.ownerId));

        target.innerHTML = `
          <h3 style="margin-top:0">${S(hond.naam) || '(zonder naam)'}</h3>
          <ul>
            <li><strong>Ras:</strong> ${S(hond.ras) || '‚Äî'}</li>
            <li><strong>Geboortedatum:</strong> ${S(hond.geboortedatum) || '‚Äî'}</li>
            <li><strong>Chip:</strong> ${S(hond.chip) || '‚Äî'}</li>
            <li><strong>Eigenaar:</strong>
              ${eigenaar ? `<a href="/klanten/detail.html?id=${encodeURIComponent(eigenaar.id)}">${S(eigenaar.naam || (eigenaar.voornaam + ' ' + (eigenaar.achternaam||'')))}</a>` : '‚Äî'}
            </li>
          </ul>
        `;
      } catch (e) {
        console.error(e);
        target.innerHTML = `<p class="error">‚ö†Ô∏è Kon hondgegevens niet laden. ${S(e.message)}</p>`;
      }
    }
    load();
  </script>
</body>
</html>
